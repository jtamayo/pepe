<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     Sep 28, 2010 4:56:48 PM                                                        

     util    
     Utilities for downloading code
                   
     juanmtamayo                                                                
     ====================================================================== -->
<project name="util">
	<description>
            Utilities for downloading code
    </description>

	<!-- get the source from svn and tar up if necessary -->
	<target name="get-svn-source" >
		<property name="svn-tmp-dir" value="svn-tmp/svn-${target-file}" />
		<!-- set the input string to "p" to get around a bug where svn asks about unknown certificates -->
		<exec executable="svn" failonerror="${fail-on-error}" inputstring="p${line.separator}">
			<arg line="-r${svn-revision}" />
			<arg line="checkout" />
			<arg line="${svn-url}" />
			<arg line="${svn-tmp-dir}" />
		</exec>
		<!-- since timestamps are kept in tar balls we force to a date before the dacapo project start -->
		<tar destfile="${target-dir}/${target-file}" basedir="${svn-tmp-dir}" compression="gzip" excludes=".svn/**,**/.svn/**" />
	</target>

	<!-- Downloads the given file from an SVN server -->
	<target name="get-svn">
		<antcall target="get-svn-source">
			<param name="svn-url" value="${svn-url}" />
			<param name="svn-revision" value="${svn-revision}" />
			<param name="target-file" value="${target-file}" />
			<param name="target-dir" value="${target-dir}" />
			<param name="fail-on-error" value="${fail-on-error}" />
		</antcall>
	</target>

	<!-- Downloads the given URL to the passed folder, only if it has been modified in the server. -->
	<target name="get-url">
		<get src="${target-url}/${target-file}" dest="${target-dir}/${target-file}" usetimestamp="true" />
	</target>

</project>
